<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Mengd@</title><meta name="author" content="Mengd@"><meta name="copyright" content="Mengd@"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><meta property="og:type" content="website">
<meta property="og:title" content="Mengd@">
<meta property="og:url" content="https://men9da.cn/index.html">
<meta property="og:site_name" content="Mengd@">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://s3.ax1x.com/2021/01/15/s010Z4.jpg">
<meta property="article:author" content="Mengd@">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://s3.ax1x.com/2021/01/15/s010Z4.jpg"><link rel="shortcut icon" href="https://s3.ax1x.com/2021/01/15/s0eSiT.png"><link rel="canonical" href="https://men9da.cn/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  ClickShowText: {"text":"Mengd@,Flag,CTF,Web,Misc,Pwn,N0p3,Nysec","fontSize":"15px"},
  lightbox: 'fancybox',
  Snackbar: undefined,
  justifiedGallery: {
    js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
    css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isanchor: false
};

var saveToLocal = {
  set: function setWithExpiry(key, value, ttl) {
    const now = new Date()
    const expiryDay = ttl * 86400000
    const item = {
      value: value,
      expiry: now.getTime() + expiryDay,
    }
    localStorage.setItem(key, JSON.stringify(item))
  },

  get: function getWithExpiry(key) {
    const itemStr = localStorage.getItem(key)

    if (!itemStr) {
      return undefined
    }
    const item = JSON.parse(itemStr)
    const now = new Date()

    if (now.getTime() > item.expiry) {
      localStorage.removeItem(key)
      return undefined
    }
    return item.value
  }
}</script><script id="config_change">var GLOBAL_CONFIG_SITE = { 
  isPost: false,
  isHome: true,
  isHighlightShrink: false,
  isToc: false,
  postUpdate: '2022-03-16 17:15:54'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(function () {  window.activateDarkMode = function () {
    document.documentElement.setAttribute('data-theme', 'dark')
    if (document.querySelector('meta[name="theme-color"]') !== null) {
      document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
    }
  }
  window.activateLightMode = function () {
    document.documentElement.setAttribute('data-theme', 'light')
   if (document.querySelector('meta[name="theme-color"]') !== null) {
      document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
    }
  }
  const autoChangeMode = 'false'
  const t = saveToLocal.get('theme')
  if (autoChangeMode === '1') {
    const isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
    const isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
    const isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
    const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified
    if (t === undefined) {
      if (isLightMode) activateLightMode()
      else if (isDarkMode) activateDarkMode()
      else if (isNotSpecified || hasNoSupport) {
        const now = new Date()
        const hour = now.getHours()
        const isNight = hour <= 6 || hour >= 18
        isNight ? activateDarkMode() : activateLightMode()
      }
      window.matchMedia('(prefers-color-scheme: dark)').addListener(function (e) {
        if (saveToLocal.get('theme') === undefined) {
          e.matches ? activateDarkMode() : activateLightMode()
        }
      })
    } else if (t === 'light') activateLightMode()
    else activateDarkMode()
  } else if (autoChangeMode === '2') {
    const now = new Date()
    const hour = now.getHours()
    const isNight = hour <= 6 || hour >= 18
    if (t === undefined) isNight ? activateDarkMode() : activateLightMode()
    else if (t === 'light') activateLightMode()
    else activateDarkMode()
  } else {
    if (t === 'dark') activateDarkMode()
    else if (t === 'light') activateLightMode()
  }const asideStatus = saveToLocal.get('aside-status')
if (asideStatus !== undefined) {
   if (asideStatus === 'hide') {
     document.documentElement.classList.add('hide-aside')
   } else {
     document.documentElement.classList.remove('hide-aside')
   }
}})()</script><link rel="stylesheet" href="/css/background.css"><meta name="generator" content="Hexo 5.2.0"><link rel="alternate" href="/atom.xml" title="Mengd@" type="application/atom+xml">
</head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="author-avatar"><img class="avatar-img" src="https://s3.ax1x.com/2021/01/15/s010Z4.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data"><div class="data-item is-center"><div class="data-item-link"><a href="/archives/"><div class="headline">文章</div><div class="length-num">24</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/tags/"><div class="headline">标签</div><div class="length-num">32</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div></div></div></div><div id="body-wrap"><header class="full_page" id="page-header"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">Mengd@</a></span><span id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div></div><span class="close" id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></span></span></nav><div id="site-info"><h1 id="site-title">Mengd@</h1><div id="site-subtitle"><span id="subtitle"></span></div></div><div id="scroll-down"><i class="fas fa-angle-down scroll-down-effects"></i></div></header><main class="layout" id="content-inner"><div class="recent-posts" id="recent-posts"><div class="recent-post-item"><div class="post_cover left_radius"><a href="/2022/03/10/%E9%80%9A%E8%BF%87%E8%B0%83%E8%AF%95%E6%BA%90%E7%A0%81%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E5%88%86%E6%9E%90RMI%E8%BF%90%E8%A1%8C%E6%9C%BA%E5%88%B6/" title="通过调试源码深入理解分析RMI运行机制(长文)">     <img class="post_bg" src="https://s1.ax1x.com/2022/03/14/bXLZLQ.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="通过调试源码深入理解分析RMI运行机制(长文)"></a></div><div class="recent-post-info"><a class="article-title" href="/2022/03/10/%E9%80%9A%E8%BF%87%E8%B0%83%E8%AF%95%E6%BA%90%E7%A0%81%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E5%88%86%E6%9E%90RMI%E8%BF%90%E8%A1%8C%E6%9C%BA%E5%88%B6/" title="通过调试源码深入理解分析RMI运行机制(长文)">通过调试源码深入理解分析RMI运行机制(长文)</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2022-03-10T12:03:49.000Z" title="发表于 2022-03-10 20:03:49">2022-03-10</time></span></div><div class="content">阅读本篇文章前注意事项如果你是初次接触RMI,JNDI等概念,请先理解阅读我写的另一篇文章”RMI-JNDI初探”,个人认为整个RMI的运行机制还是非常复杂的,因为他在整个调用的过程中是多线程的,有非常非常多的坑点,本篇文章将以RMI运行过程为大纲,深入剖析其运行原理。
本篇文章运行环境为JDK7U80
[TOC]
第一步:服务端开启注册服务调试代码:
Server端:
1Registry registry &#x3D; LocateRegistry.createRegistry(1099);

Client端:
12Registry registry &#x3D; LocateRegistry.getRegistry(&quot;127.0.0.1&quot;,1099);registry.lookup(&quot;hello&quot;);

一切准备就绪,跟随Server端的启动进入RMI的调用旅程


跟进后首先便是实例化RegistryImpl对象


进入RegistryImpl类的构造函数,实例化一个LiveRef对象,var2就是端口号1099,此时this为Regis ...</div></div></div><div class="recent-post-item"><div class="post_cover right_radius"><a href="/2022/03/07/RMI-JNDI%E7%94%B1%E6%B5%85%E5%85%A5%E6%B7%B1/" title="RMI,JNDI初探">     <img class="post_bg" src="https://s1.ax1x.com/2022/03/14/bXLZLQ.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="RMI,JNDI初探"></a></div><div class="recent-post-info"><a class="article-title" href="/2022/03/07/RMI-JNDI%E7%94%B1%E6%B5%85%E5%85%A5%E6%B7%B1/" title="RMI,JNDI初探">RMI,JNDI初探</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2022-03-07T11:56:29.000Z" title="发表于 2022-03-07 19:56:29">2022-03-07</time></span></div><div class="content">前言:在学习JAVA安全的路上有许多不顺利的地方,早早就听闻RMI,JNDI注入。最初我作为一个初学者,以为JNDI注入是不是就是类似sql注入和ongl表达式注入那样在某个输入框输入payload直接就触发然后就命令执行,带出数据xxx或者执行其他操作.但是当我初次研究后,处于一脸懵逼的状态,他好像比我想象中的复杂,接触初期觉得复杂肯定不是因为背后的代码有多么复杂,而是被概念搞混。本篇文章将会又最基本的概念解释开始讲起,逐渐深入其实现原理。
什么是RMI?RMI全称(Java Remote Method Invocation)JAVA远程方法调用,顾名思义,RMI是一个行为,我们把在一个JVM中调用另一个JVM中的JAVA方法的这种行为称之为RMI。
要完成RMI这个行为,我们分为三个步骤
1.Client-客户端 调用服务端方法
2.Server-服务端 给客户端提供方法进行调用注:代码将在服务端执行,而不是客户端。客户端获得的只是方法在客户端执行后的返回值
3.Register-注册中心 :本质是一个map,里面保存着客户端查询要调用的方法的引用
举个例子,下面编写两个程序,一个 ...</div></div></div><div class="recent-post-item"><div class="post_cover left_radius"><a href="/2022/03/03/java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%85%A5%E9%97%A8-URLDNS/" title="java反序列化入门(URLDNS)">     <img class="post_bg" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="java反序列化入门(URLDNS)"></a></div><div class="recent-post-info"><a class="article-title" href="/2022/03/03/java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%85%A5%E9%97%A8-URLDNS/" title="java反序列化入门(URLDNS)">java反序列化入门(URLDNS)</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2022-03-03T09:00:20.000Z" title="发表于 2022-03-03 17:00:20">2022-03-03</time></span></div><div class="content">前言:反序列化漏洞在研究java反序列化漏洞之前大家肯定也对php反序列化漏洞,python反序列化漏洞有一定的了解.为什么反序列化漏洞如此盛行,在多个语言中都存在呢? 在学习java反序列化的时候我抛出了这样一个疑问.虽然本人水平有限并且短时间内难以准确回答这个问题,但是我从php反序列化和java反序列化中找到他们的相同与不同处,可能一定程度上能帮助我理解java反序列化.
反序列化漏洞的逻辑是什么?反序列化漏洞的触发是一个链型的逻辑,我们把这个链形调用链的开头,中部,结尾划分为以下三个部分
1.链的开头:在反序列化过程中执行或反序列化后执行的,我们称之为“kick-off” gadget
2.中部: 各种chain,起到链接1和3的作用
3.链的结尾:执行的任意代码或者命令的类(达成恶意目的) 我们称之为”sink” gadget
我们在代码中去寻找1和3,然后再找能让1和3链接起来的逻辑,从而形成一条完整的调用链触发恶意代码
PHP反序列化链中的kick-offphp中引入了魔法函数这一概念,对象在一些特殊状态下会触发他们.例如对象被初始化时使用的时候的__construct方 ...</div></div></div><div class="recent-post-item"><div class="post_cover right_radius"><a href="/2022/02/22/JAVA%E5%B8%B8%E7%94%A8%E7%89%B9%E6%80%A7%E8%AF%A6%E8%A7%A3%E8%AE%B0%E5%BD%95/" title="JAVA常用特性详解">     <img class="post_bg" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="JAVA常用特性详解"></a></div><div class="recent-post-info"><a class="article-title" href="/2022/02/22/JAVA%E5%B8%B8%E7%94%A8%E7%89%B9%E6%80%A7%E8%AF%A6%E8%A7%A3%E8%AE%B0%E5%BD%95/" title="JAVA常用特性详解">JAVA常用特性详解</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2022-02-22T08:55:23.000Z" title="发表于 2022-02-22 16:55:23">2022-02-22</time></span></div><div class="content">作为一个没有进行过JAVA开发的菜鸡,在审计代码的过程中经常会遇到JAVA的一些特性,了解这些特性是必要的.我采用一边学习一边记录的方式,在学习JAVA安全过程中遇到的各种JAVA特性,概念在这里进行统一的学习记录,以方便查看.
这里我把他们分为两个类型,需要详细深入分析(以下简称详细)**的和了解用法原理(以下简称了解)的,**了解指能让我更好的理解读懂代码,详细指对漏洞触发,漏洞原理有直接影响的的核心特性.
目录:
[TOC]
泛型(了解)泛型,顾名思义广泛的数据类型,如何让一个变量成为任意的数据类型呢?答:让他成为泛型
例子:在JAVA中List就是一个泛型,我们可以往里面存各种数据,string,int,float,object都可以
可能出现的疑问(会在最后解答):为什么List是一个泛型?
12345List demo = new ArrayList();demo.add(123);//Integerdemo.add(&quot;123&quot;);//StringSystem.out.println(demo.get(0));System.out.println(dem ...</div></div></div><div class="recent-post-item"><div class="post_cover left_radius"><a href="/2022/01/28/Struts2-S007%E8%AF%A6%E7%BB%86%E5%88%86%E6%9E%90/" title="Struts2-S007详细分析">     <img class="post_bg" src="https://s4.ax1x.com/2022/01/27/7jwhwV.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Struts2-S007详细分析"></a></div><div class="recent-post-info"><a class="article-title" href="/2022/01/28/Struts2-S007%E8%AF%A6%E7%BB%86%E5%88%86%E6%9E%90/" title="Struts2-S007详细分析">Struts2-S007详细分析</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2022-01-28T04:42:59.000Z" title="发表于 2022-01-28 12:42:59">2022-01-28</time></span></div><div class="content">前言:在分析007的过程中发现007和001有一定的相似程度,但是在搭建环境的时候被网上不少文章给误导了,很明显这些文章并不是很清楚整个漏洞的触发条件以及原理,大部分的文章都会添加一个[ActionName]-validation.xml的验证表单,好像这个东西是整个漏洞触发的必要条件.后来发现这个是vulhub中带的,大家没有自己搭建环境就直接下载现成环境自然而然也不会去追究为什么会有这么一个东西以及他究竟是不是有必要的所以自己搭建环境进行复现是非常有必要的
0X01:环境搭建S2-007究竟会在什么样的一个环境下触发,首先就需要直到为什么会造成这个漏洞
很多文章一开头就说了,这个漏洞发生在类型转换时如果发生错误(比如abcd不能转换为int类型)的时候会将错误保存起来,然后将发生错误的参数传入input视图(struct.xml中配置),input视图如果存在标签解析,而这个标签恰巧是我们的可控数值,这个时候就struct就会默认尝试先去使用ognl解析这个标签的值,如果此时我们的值是一个ognl表达式那么就会被解析了
所以能够造成此漏洞的需要的必要环境条件是
1.于存在类型转换错 ...</div></div></div><div class="recent-post-item"><div class="post_cover right_radius"><a href="/2022/01/28/%E5%B8%B8%E7%94%A8%E5%8D%95%E8%AF%8D%E9%9A%8F%E7%AC%94%E8%AE%B0%E5%BD%95/" title="常用单词随笔记录">     <img class="post_bg" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="常用单词随笔记录"></a></div><div class="recent-post-info"><a class="article-title" href="/2022/01/28/%E5%B8%B8%E7%94%A8%E5%8D%95%E8%AF%8D%E9%9A%8F%E7%AC%94%E8%AE%B0%E5%BD%95/" title="常用单词随笔记录">常用单词随笔记录</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2022-01-27T16:38:40.000Z" title="发表于 2022-01-28 00:38:40">2022-01-28</time></span></div><div class="content">为什么会有这样一个文章?
在我们看别人代码的时候,大部分变量名是以英文命名的,虽然我们有翻译软件可以翻译,但是在审计代码的过程中复杂的调用过程都去百度翻译一下是很浪费时间的而且很有可能让本来都不通顺的思维打断,我常常通过变量名,方法名作为理解一个函数作用的重要方法,英语又是我非常烂的一门学科,所以有了这篇文章,这篇文章会一直更新,记录那些常用的单词,并解释他们作为变量名的时候的含义,**并且同时学习代码编写规范,**这样才能更好的看懂别人的代码.
12345678910111213141516handle:句柄Conversion :转换Exception:异常property:属性Intercept:拦截器invoke:激活,引用invocation:调用iterator:迭代器pre:pre- 开头的函数或者变量名，通常会在程序的核心流程之前发生、进行；contains:包含util:工具类会带上,是utiliy的缩写compile:编译Malformed:格式错误sequence:序列External:外部Serial:连续的

</div></div></div><div class="recent-post-item"><div class="post_cover left_radius"><a href="/2022/01/27/Struts2-S005%E8%AF%A6%E7%BB%86%E5%88%86%E6%9E%90/" title="Struts2-S2 005详细分析">     <img class="post_bg" src="https://s4.ax1x.com/2022/01/27/7jwhwV.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Struts2-S2 005详细分析"></a></div><div class="recent-post-info"><a class="article-title" href="/2022/01/27/Struts2-S005%E8%AF%A6%E7%BB%86%E5%88%86%E6%9E%90/" title="Struts2-S2 005详细分析">Struts2-S2 005详细分析</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2022-01-27T06:08:33.000Z" title="发表于 2022-01-27 14:08:33">2022-01-27</time></span></div><div class="content">前言:注:如果你跟我一样是个菜鸡并且没有看过S2-003,那么强烈建议去看一下S2-003的调用过程,我也有写,可以先看一下
昨天刚啃完了struts2-s003,第一次分析觉得超级复杂花费了大量的时间,同时也对整个解析流程熟悉了很多,听说S2-005是S2-003的绕过,不妨趁热打铁,直接分析一下.
注:以下内容以及思维逻辑站在一个刚开始接触java审计的菜鸡身上,同时也能记录我的思维进步过程
由于熟悉S2-003的调用过程,当我首次看网上各类文章的时候,分为两种
第一种:简单介绍一下这个是s2-003的绕过,然后提了一下unicode编码绕过,然后就说官方是通过增加一个沙盒模式进行修复,然后就是下载现成环境打一发payload结束
第二种:一些大佬们直接从代码层面分析代码的改动,首先新增了几个接口,由xxx实现,解释了一大波新的内容,新增了xxxx方法,这对于我这种开发经验不足且刚接触java审计的菜鸡无疑是毁灭性的打击,但是,既然是针对S2-003的绕过,那我就饶过这个本质而言,先尝试自己分析为什么旧的payload不能执行了分析完后没想到并没有这么复杂并且我自己在没有看别人发的 ...</div></div></div><div class="recent-post-item"><div class="post_cover right_radius"><a href="/2022/01/26/Struts2-S003%E8%AF%A6%E7%BB%86%E5%88%86%E6%9E%90/" title="Struts2-S2 003详细分析">     <img class="post_bg" src="https://s4.ax1x.com/2022/01/27/7jwhwV.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Struts2-S2 003详细分析"></a></div><div class="recent-post-info"><a class="article-title" href="/2022/01/26/Struts2-S003%E8%AF%A6%E7%BB%86%E5%88%86%E6%9E%90/" title="Struts2-S2 003详细分析">Struts2-S2 003详细分析</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2022-01-26T03:10:30.000Z" title="发表于 2022-01-26 11:10:30">2022-01-26</time></span></div><div class="content">前言:S2-003是第我审计的第二个java漏洞,其中核心还是围绕着OGNL表达式注入的利用,在我的”Struts2-S001”中以一种初学者的理解讲解了ognl表达式的用法,如果说S2-001的作用是让我大概了解了Struts2的执行流程,那么这次的S2-003让我深入了解了ognl的执行原理,网上对于S2-003的解释十分有限,内容不相同的文章就没有几篇,其中有一些我认为很复杂的概念没有讲出来,导致整个利用原理让人摸不着头脑,为什么payload形如(one)(two)?这些括号的意义是什么?为什么ognl就会解析one,而不会解析two呢,为什么(one)(two)(three)甚至是(one)(two)(three)(four)…也是可以成功执行的呢?这涉及以下几个核心概念,本篇文章会在恰当的地方进行解释.
1.什么是ASTchain,他长什么样?
2.ognl是如何解析各种类型的AST的
3.payload被解析为ASTchain后是什么一个形式
4.payload的解析顺序
0X01:利用过程&amp;环境搭建先写利用过程
12GET &#x2F;Struts2-s003& ...</div></div></div><div class="recent-post-item"><div class="post_cover left_radius"><a href="/2022/01/14/UDF%E6%8F%90%E6%9D%83/" title="UDF提权">     <img class="post_bg" src="https://z3.ax1x.com/2021/05/22/gqkm3F.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="UDF提权"></a></div><div class="recent-post-info"><a class="article-title" href="/2022/01/14/UDF%E6%8F%90%E6%9D%83/" title="UDF提权">UDF提权</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2022-01-14T08:32:56.000Z" title="发表于 2022-01-14 16:32:56">2022-01-14</time></span></div><div class="content">UDF（user defined function)mysql自带的函数有user(),version()等,除了自带的函数,用户可以自定义一些函数方便在查询的时候使用它们,我们把这些函数称之为UDF(user defined function)
用法:
1create function function_name returns &#123;string|integer|real|decimal&#125; routine_body

function_name:函数名
routine_body:由合法的sql语句构成的函数体
举个例子:
 查询user表id为1的username我们应该这么写:
1select username from user where id &#x3D; 1;

执行结果如下:
12345+----------+| username |+----------+| mengda   |+----------+

这个时候我们自定义一个函数
1create function getUserName(userid int) returns varchar(30) ...</div></div></div><div class="recent-post-item"><div class="post_cover right_radius"><a href="/2022/01/09/Struts2-S001%E8%AF%A6%E7%BB%86%E5%88%86%E6%9E%90/" title="Struts2-S2 001详细分析">     <img class="post_bg" src="https://s4.ax1x.com/2022/01/27/7jwhwV.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Struts2-S2 001详细分析"></a></div><div class="recent-post-info"><a class="article-title" href="/2022/01/09/Struts2-S001%E8%AF%A6%E7%BB%86%E5%88%86%E6%9E%90/" title="Struts2-S2 001详细分析">Struts2-S2 001详细分析</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2022-01-09T07:03:04.000Z" title="发表于 2022-01-09 15:03:04">2022-01-09</time></span></div><div class="content">前言:本篇文章是站在一个只会一丁点java基础,没有任何Java开发经验的的菜鸡眼中去完成的.所设计知识点繁多,杂乱,从Struts2的执行流程到漏洞Rce,适合小白看.本次分析的是Struts2-S001,版本为2.0.8
0X01:OGNL表达式OGNL 是 Object Graphic Navigation Language (对象图导航语言)的缩写，是一个开源项目。它是一种功能强大的表达式语言，通过它简单一致的表达式语法，可以存取对象的任意属性，调用对象的方法。
Struts2 中支持以下几种表达式语言：OGNL、JSTL、Groovy、Velocity。Struts 框架使用 OGNL 作为默认的表达式语言。
为什么这里要提到OGNL表达式呢?因为就是OGNL存在可以执行java代码的函数,而Struts2使用了OGNL进行开发,但是在这个过程中由于疏忽导致用户可控OGNL处理的表达式数据从而造成注入.
打个比方,就好比php里面开发者用了eval()函数,但是呢由于开发不严谨导致eval()函数的参数被用户可控了,那肯定就直接RCE了.
OGNL表达式到底怎么用呢?我们来举 ...</div></div></div><nav id="pagination"><div class="pagination"><span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><a class="extend next" rel="next" href="/page/2/"><i class="fas fa-chevron-right fa-fw"></i></a></div></nav></div><div class="aside_content" id="aside_content"><div class="card-widget card-info"><div class="card-content"><div class="card-info-avatar is-center"><img class="avatar-img" src="https://s3.ax1x.com/2021/01/15/s010Z4.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/><div class="author-info__name">Mengd@</div><div class="author-info__description"></div></div><div class="card-info-data"><div class="card-info-data-item is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">24</div></a></div><div class="card-info-data-item is-center"><a href="/tags/"><div class="headline">标签</div><div class="length-num">32</div></a></div></div><a class="button--animated" id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/Kumengda"><i class="fab fa-github"></i><span>访问我的github</span></a></div></div><div class="card-widget card-announcement"><div class="card-content"><div class="item-headline"><i class="fas fa-bullhorn card-announcement-animation"></i><span>公告</span></div><div class="announcement_content">This is Mengd@ Blog</div></div></div><div class="sticky_layout"><div class="card-widget card-recent-post"><div class="card-content"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2022/03/10/%E9%80%9A%E8%BF%87%E8%B0%83%E8%AF%95%E6%BA%90%E7%A0%81%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E5%88%86%E6%9E%90RMI%E8%BF%90%E8%A1%8C%E6%9C%BA%E5%88%B6/" title="通过调试源码深入理解分析RMI运行机制(长文)"><img src="https://s1.ax1x.com/2022/03/14/bXLZLQ.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="通过调试源码深入理解分析RMI运行机制(长文)"/></a><div class="content"><a class="title" href="/2022/03/10/%E9%80%9A%E8%BF%87%E8%B0%83%E8%AF%95%E6%BA%90%E7%A0%81%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E5%88%86%E6%9E%90RMI%E8%BF%90%E8%A1%8C%E6%9C%BA%E5%88%B6/" title="通过调试源码深入理解分析RMI运行机制(长文)">通过调试源码深入理解分析RMI运行机制(长文)</a><time datetime="2022-03-10T12:03:49.000Z" title="发表于 2022-03-10 20:03:49">2022-03-10</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/03/07/RMI-JNDI%E7%94%B1%E6%B5%85%E5%85%A5%E6%B7%B1/" title="RMI,JNDI初探"><img src="https://s1.ax1x.com/2022/03/14/bXLZLQ.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="RMI,JNDI初探"/></a><div class="content"><a class="title" href="/2022/03/07/RMI-JNDI%E7%94%B1%E6%B5%85%E5%85%A5%E6%B7%B1/" title="RMI,JNDI初探">RMI,JNDI初探</a><time datetime="2022-03-07T11:56:29.000Z" title="发表于 2022-03-07 19:56:29">2022-03-07</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/03/03/java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%85%A5%E9%97%A8-URLDNS/" title="java反序列化入门(URLDNS)"><img src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="java反序列化入门(URLDNS)"/></a><div class="content"><a class="title" href="/2022/03/03/java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%85%A5%E9%97%A8-URLDNS/" title="java反序列化入门(URLDNS)">java反序列化入门(URLDNS)</a><time datetime="2022-03-03T09:00:20.000Z" title="发表于 2022-03-03 17:00:20">2022-03-03</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/02/22/JAVA%E5%B8%B8%E7%94%A8%E7%89%B9%E6%80%A7%E8%AF%A6%E8%A7%A3%E8%AE%B0%E5%BD%95/" title="JAVA常用特性详解"><img src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="JAVA常用特性详解"/></a><div class="content"><a class="title" href="/2022/02/22/JAVA%E5%B8%B8%E7%94%A8%E7%89%B9%E6%80%A7%E8%AF%A6%E8%A7%A3%E8%AE%B0%E5%BD%95/" title="JAVA常用特性详解">JAVA常用特性详解</a><time datetime="2022-02-22T08:55:23.000Z" title="发表于 2022-02-22 16:55:23">2022-02-22</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/01/28/Struts2-S007%E8%AF%A6%E7%BB%86%E5%88%86%E6%9E%90/" title="Struts2-S007详细分析"><img src="https://s4.ax1x.com/2022/01/27/7jwhwV.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Struts2-S007详细分析"/></a><div class="content"><a class="title" href="/2022/01/28/Struts2-S007%E8%AF%A6%E7%BB%86%E5%88%86%E6%9E%90/" title="Struts2-S007详细分析">Struts2-S007详细分析</a><time datetime="2022-01-28T04:42:59.000Z" title="发表于 2022-01-28 12:42:59">2022-01-28</time></div></div></div></div></div><div class="card-widget card-tags"><div class="card-content"><div class="item-headline"><i class="fas fa-tags"></i><span>标签</span></div><div class="card-tag-cloud"><a href="/tags/BUUCTF/" style="font-size: 1.1em; color: #999">BUUCTF</a> <a href="/tags/CBC%E5%AD%97%E8%8A%82%E7%BF%BB%E8%BD%AC%E6%94%BB%E5%87%BB/" style="font-size: 1.1em; color: #999">CBC字节翻转攻击</a> <a href="/tags/CTF/" style="font-size: 1.18em; color: #999ca1">CTF</a> <a href="/tags/CTF%E5%A4%8D%E7%8E%B0/" style="font-size: 1.1em; color: #999">CTF复现</a> <a href="/tags/Golang/" style="font-size: 1.1em; color: #999">Golang</a> <a href="/tags/JAVA/" style="font-size: 1.1em; color: #999">JAVA</a> <a href="/tags/JAVA%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/" style="font-size: 1.1em; color: #999">JAVA反序列化</a> <a href="/tags/JAVA%E5%AE%89%E5%85%A8/" style="font-size: 1.5em; color: #99a9bf">JAVA安全</a> <a href="/tags/JAVA%E7%89%B9%E6%80%A7/" style="font-size: 1.1em; color: #999">JAVA特性</a> <a href="/tags/JNDI%E6%B3%A8%E5%85%A5/" style="font-size: 1.1em; color: #999">JNDI注入</a> <a href="/tags/Java%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/" style="font-size: 1.42em; color: #99a6b7">Java代码审计</a> <a href="/tags/PHP/" style="font-size: 1.1em; color: #999">PHP</a> <a href="/tags/RMI%E6%B3%A8%E5%85%A5/" style="font-size: 1.1em; color: #999">RMI注入</a> <a href="/tags/RMI%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/" style="font-size: 1.1em; color: #999">RMI源码分析</a> <a href="/tags/Redis/" style="font-size: 1.1em; color: #999">Redis</a> <a href="/tags/SQL%E6%B3%A8%E5%85%A5/" style="font-size: 1.1em; color: #999">SQL注入</a> <a href="/tags/SSRF/" style="font-size: 1.18em; color: #999ca1">SSRF</a> <a href="/tags/Struts2/" style="font-size: 1.34em; color: #99a3b0">Struts2</a> <a href="/tags/Thinkphp5/" style="font-size: 1.26em; color: #999fa8">Thinkphp5</a> <a href="/tags/URLDNS/" style="font-size: 1.1em; color: #999">URLDNS</a> <a href="/tags/XDEBUG/" style="font-size: 1.1em; color: #999">XDEBUG</a> <a href="/tags/bmp%E9%9A%90%E5%86%99/" style="font-size: 1.1em; color: #999">bmp隐写</a> <a href="/tags/pwn%E5%85%A5%E9%97%A8/" style="font-size: 1.1em; color: #999">pwn入门</a> <a href="/tags/udf%E6%8F%90%E6%9D%83/" style="font-size: 1.1em; color: #999">udf提权</a> <a href="/tags/web/" style="font-size: 1.1em; color: #999">web</a> <a href="/tags/web%E5%AE%89%E5%85%A8/" style="font-size: 1.1em; color: #999">web安全</a> <a href="/tags/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/" style="font-size: 1.1em; color: #999">代码审计</a> <a href="/tags/%E5%8A%A8%E6%80%81%E8%B0%83%E8%AF%95/" style="font-size: 1.1em; color: #999">动态调试</a> <a href="/tags/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/" style="font-size: 1.18em; color: #999ca1">反序列化</a> <a href="/tags/%E5%B8%B8%E7%94%A8%E5%8D%95%E8%AF%8D%E8%AE%B0%E5%BD%95/" style="font-size: 1.1em; color: #999">常用单词记录</a> <a href="/tags/%E6%BA%90%E7%A0%81%E5%AE%A1%E8%AE%A1/" style="font-size: 1.26em; color: #999fa8">源码审计</a> <a href="/tags/%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/" style="font-size: 1.1em; color: #999">漏洞复现</a></div></div></div><div class="card-widget card-archives"><div class="card-content"><div class="item-headline"><i class="fas fa-archive"></i><span>归档</span></div><ul class="card-archive-list"><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2022/03/"><span class="card-archive-list-date">三月 2022</span><span class="card-archive-list-count">3</span></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2022/02/"><span class="card-archive-list-date">二月 2022</span><span class="card-archive-list-count">1</span></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2022/01/"><span class="card-archive-list-date">一月 2022</span><span class="card-archive-list-count">6</span></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2021/11/"><span class="card-archive-list-date">十一月 2021</span><span class="card-archive-list-count">1</span></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2021/05/"><span class="card-archive-list-date">五月 2021</span><span class="card-archive-list-count">5</span></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2021/04/"><span class="card-archive-list-date">四月 2021</span><span class="card-archive-list-count">1</span></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2021/03/"><span class="card-archive-list-date">三月 2021</span><span class="card-archive-list-count">2</span></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2021/01/"><span class="card-archive-list-date">一月 2021</span><span class="card-archive-list-count">2</span></a></li><li class="card-archive-list-item more is-center"><a class="card-archive-list-link-more" href="/archives/">
              <span>查看更多</span><i class="fas fa-angle-right"  ></i></a></li></ul></div></div><div class="card-widget card-webinfo"><div class="card-content"><div class="item-headline"><i class="fas fa-chart-line"></i><span>网站资讯</span></div><div class="webinfo"><div class="webinfo-item"><div class="item-name">文章数目 :</div><div class="item-count">24</div></div><div class="webinfo-item"><div class="item-name">本站访客数 :</div><div class="item-count" id="busuanzi_value_site_uv"></div></div><div class="webinfo-item"><div class="item-name">本站总访问量 :</div><div class="item-count" id="busuanzi_value_site_pv"></div></div><div class="webinfo-item"><div class="item-name">最后更新时间 :</div><div class="item-count" id="last-push-date" data-lastPushDate="2022-03-16T09:15:53.903Z"></div></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2022 By Mengd@</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog"></i></button><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><div class="js-pjax"><script>function subtitleType () {
  $.getScript('https://sdk.jinrishici.com/v2/browser/jinrishici.js',function () {
    jinrishici.load(function (result) {
      if (true) {
        var sub = "Welcome To Mengd@ Blog".length == 0 ? new Array() : "Welcome To Mengd@ Blog".split(',')
        var content = result.data.content
        var both = sub.unshift(content)
        var typed = new Typed('#subtitle', {
          strings: sub,
          startDelay: 300,
          typeSpeed: 150,
          loop: true,
          backSpeed: 50,
        })
      } else {
        document.getElementById('subtitle').innerHTML = result.data.content
      }
    })
  })
}

if (true) {
  if (typeof Typed === 'function') subtitleType()
  else $.getScript('https://cdn.jsdelivr.net/npm/typed.js/lib/typed.min.js', subtitleType)
} else {
  subtitleType()
}
</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><canvas class="fireworks" mobile="false"></canvas><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/fireworks.min.js"></script><script defer="defer" id="ribbon" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/canvas-ribbon.min.js" size="150" alpha="0.6" zIndex="-1" mobile="false" data-click="false"></script><script id="click-show-text" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/click-show-text.min.js" async="async" mobile="false"></script></div></body></html>